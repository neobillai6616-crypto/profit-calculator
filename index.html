<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon Deal Fee åˆ©æ½¤è¨ˆç®—å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        .chart-container {
            position: relative;
            height: 250px;
            width: 100%;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9);
        }
        .slider-thumb::-webkit-slider-thumb {
            appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: 2px solid #ffffff;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        .slider-thumb::-moz-range-thumb {
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: 2px solid #ffffff;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="min-h-screen gradient-bg">
    <!-- Header -->
    <header class="glass-effect shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="bg-blue-600 p-2 rounded-lg">
                        <svg class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">Amazon Deal Fee åˆ©æ½¤è¨ˆç®—å™¨</h1>
                        <p class="text-sm text-gray-600">ç²¾æº–è¨ˆç®— Amazon ä¿ƒéŠ·æ´»å‹•çš„å¯¦éš›æ”¶ç›Š</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-600">æ‡‰å° Deal Fee æ¼²åƒ¹</p>
                    <p class="text-xs text-gray-500">å°ˆæ¥­ç‰ˆåˆ©æ½¤åˆ†æå·¥å…·</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Column - Input Controls -->
            <div class="lg:col-span-2 space-y-6">
                <!-- åŸºæœ¬è¨­ç½® -->
                <div class="glass-effect p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold text-gray-700 mb-4 flex items-center">
                        <svg class="h-5 w-5 mr-2 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                        åŸºæœ¬è¨­ç½®
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="currency" class="block text-sm font-medium text-gray-600 mb-2">å¹£åˆ¥</label>
                            <select id="currency" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="USD">USD - ç¾å…ƒ</option>
                                <option value="EUR">EUR - æ­å…ƒ</option>
                                <option value="GBP">GBP - è‹±éŠ</option>
                                <option value="JPY">JPY - æ—¥åœ“</option>
                            </select>
                        </div>
                        <div>
                            <label for="marketplace" class="block text-sm font-medium text-gray-600 mb-2">å¸‚å ´</label>
                            <select id="marketplace" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="US">ç¾åœ‹ (US)</option>
                                <option value="UK">è‹±åœ‹ (UK)</option>
                                <option value="DE">å¾·åœ‹ (DE)</option>
                                <option value="JP">æ—¥æœ¬ (JP)</option>
                            </select>
                        </div>
                        <div>
                            <label for="sessions" class="block text-sm font-medium text-gray-600 mb-2">é ä¼°æœˆç€è¦½é‡ (Sessions)</label>
                            <input type="number" id="sessions" value="5000" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label for="selling-price" class="block text-sm font-medium text-gray-600 mb-2">æ­£å¸¸å”®åƒ¹</label>
                            <input type="number" id="selling-price" value="25" min="0" step="0.01" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                </div>

                <!-- æˆæœ¬çµæ§‹ -->
                <div class="glass-effect p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold text-gray-700 mb-4 flex items-center">
                        <svg class="h-5 w-5 mr-2 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
                        </svg>
                        æˆæœ¬çµæ§‹è¨­å®š
                    </h3>
                    <div class="space-y-6">
                        <div class="space-y-2">
                            <label for="product-cost" class="block text-sm font-medium text-gray-600">
                                ç”¢å“æ¡è³¼æˆæœ¬: <span id="product-cost-val" class="font-bold text-blue-600">20</span>%
                            </label>
                            <input type="range" id="product-cost" value="20" min="0" max="100" step="1" 
                                   class="slider-thumb w-full h-2 bg-blue-100 rounded-lg appearance-none cursor-pointer">
                            <div class="flex justify-between text-xs text-gray-500">
                                <span>0%</span>
                                <span>50%</span>
                                <span>100%</span>
                            </div>
                        </div>
                        
                        <div class="space-y-2">
                            <label for="fba-fee" class="block text-sm font-medium text-gray-600">
                                FBA è²»ç”¨: $<span id="fba-fee-val" class="font-bold text-blue-600">5.00</span>
                            </label>
                            <input type="range" id="fba-fee" value="5" min="0" max="50" step="0.1" 
                                   class="slider-thumb w-full h-2 bg-blue-100 rounded-lg appearance-none cursor-pointer">
                            <div class="flex justify-between text-xs text-gray-500">
                                <span>$0</span>
                                <span>$25</span>
                                <span>$50</span>
                            </div>
                        </div>
                        
                        <div class="space-y-2">
                            <label for="tacos" class="block text-sm font-medium text-gray-600">
                                TACOS (å»£å‘Šä½”ç¸½æ”¶å…¥ç™¾åˆ†æ¯”): <span id="tacos-val" class="font-bold text-blue-600">10</span>%
                            </label>
                            <input type="range" id="tacos" value="10" min="0" max="50" step="0.1" 
                                   class="slider-thumb w-full h-2 bg-blue-100 rounded-lg appearance-none cursor-pointer">
                            <div class="flex justify-between text-xs text-gray-500">
                                <span>0%</span>
                                <span>25%</span>
                                <span>50%</span>
                            </div>
                        </div>
                        
                        <div class="space-y-2">
                            <label for="return-rate" class="block text-sm font-medium text-gray-600">
                                é€€è²¨ç‡: <span id="return-rate-val" class="font-bold text-blue-600">5</span>%
                            </label>
                            <input type="range" id="return-rate" value="5" min="0" max="50" step="0.1" 
                                   class="slider-thumb w-full h-2 bg-blue-100 rounded-lg appearance-none cursor-pointer">
                            <div class="flex justify-between text-xs text-gray-500">
                                <span>0%</span>
                                <span>25%</span>
                                <span>50%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ä¿ƒéŠ·æ´»å‹•è¨­å®š -->
                <div class="glass-effect p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold text-gray-700 mb-4 flex items-center">
                        <svg class="h-5 w-5 mr-2 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                        </svg>
                        ä¿ƒéŠ·æ´»å‹•è¨­å®š
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="deal-type" class="block text-sm font-medium text-gray-600 mb-2">ä¿ƒéŠ·æ´»å‹•é¡å‹</label>
                            <select id="deal-type" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="none">ç„¡ä¿ƒéŠ·</option>
                                <option value="lightning-deal">ç§’æ®º (Lightning Deal)</option>
                                <option value="7-day-deal">7å¤©ä¿ƒéŠ· (7-day Deal)</option>
                                <option value="coupon">å„ªæƒ åˆ¸ (Coupon)</option>
                            </select>
                        </div>
                    </div>
                    <div id="deal-options" class="space-y-4">
                        <!-- å‹•æ…‹ç”Ÿæˆçš„ä¿ƒéŠ·é¸é …å°‡åœ¨é€™è£¡é¡¯ç¤º -->
                    </div>
                </div>
            </div>

            <!-- Right Column - Results -->
            <div class="space-y-6">
                <!-- çµæœé¡¯ç¤º -->
                <div class="glass-effect p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold text-gray-700 mb-4 flex items-center">
                        <svg class="h-5 w-5 mr-2 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                        è¨ˆç®—çµæœ
                    </h3>
                    <div class="space-y-4">
                        <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-400">
                            <p class="text-sm font-medium text-blue-600">é ä¼°æœˆéŠ·é‡</p>
                            <p id="sales-volume" class="text-2xl font-bold text-blue-800">0</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-400">
                            <p class="text-sm font-medium text-green-600">æœˆç¸½æ”¶å…¥</p>
                            <p id="total-revenue" class="text-2xl font-bold text-green-800">$0.00</p>
                        </div>
                        <div class="bg-red-50 p-4 rounded-lg border-l-4 border-red-400">
                            <p class="text-sm font-medium text-red-600">æœˆç¸½æˆæœ¬</p>
                            <p id="total-cost" class="text-2xl font-bold text-red-800">$0.00</p>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg border-l-4 border-purple-400">
                            <p class="text-sm font-medium text-purple-600">æœˆæ·¨åˆ©æ½¤</p>
                            <p id="net-profit" class="text-2xl font-bold text-purple-800">$0.00</p>
                        </div>
                        <div class="bg-indigo-50 p-4 rounded-lg border-l-4 border-indigo-400">
                            <p class="text-sm font-medium text-indigo-600">åˆ©æ½¤ç‡</p>
                            <p id="profit-margin" class="text-2xl font-bold text-indigo-800">0%</p>
                        </div>
                    </div>
                </div>

                <!-- ç­–ç•¥å»ºè­° -->
                <div class="glass-effect p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold text-gray-700 mb-4 flex items-center">
                        <svg class="h-5 w-5 mr-2 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                        </svg>
                        ç­–ç•¥å»ºè­°
                    </h3>
                    <div class="bg-yellow-50 p-4 rounded-lg">
                        <p id="strategy-suggestion" class="text-gray-700 text-sm leading-relaxed">
                            è«‹èª¿æ•´åƒæ•¸ä»¥ç²å¾—ç­–ç•¥å»ºè­°...
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- è½‰åŒ–ç‡è¨­å®š -->
        <div class="mt-8">
            <div class="glass-effect p-6 rounded-xl shadow-lg">
                <h3 class="text-xl font-bold text-gray-700 mb-4 flex items-center">
                    <svg class="h-5 w-5 mr-2 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                    </svg>
                    è½‰åŒ–ç‡è¨­å®š
                </h3>
                <p class="text-sm text-gray-600 mb-6">è«‹è¨­å®šä¸åŒæŠ˜æ‰£æ¯”ä¾‹ä¸‹çš„é ä¼°è½‰åŒ–ç‡ï¼Œç³»çµ±å°‡è‡ªå‹•æ’å€¼è¨ˆç®—ä¸­é–“å€¼ã€‚</p>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="space-y-2">
                        <label for="cr-0" class="block text-sm font-medium text-gray-600">
                            0% æŠ˜æ‰£è½‰åŒ–ç‡: <span id="cr-0-val" class="font-bold text-blue-600">10</span>%
                        </label>
                        <input type="range" id="cr-0" value="10" min="0" max="50" step="0.1" 
                               class="slider-thumb w-full h-2 bg-blue-100 rounded-lg appearance-none cursor-pointer">
                    </div>
                    <div class="space-y-2">
                        <label for="cr-5" class="block text-sm font-medium text-gray-600">
                            5% æŠ˜æ‰£è½‰åŒ–ç‡: <span id="cr-5-val" class="font-bold text-blue-600">11</span>%
                        </label>
                        <input type="range" id="cr-5" value="11" min="0" max="50" step="0.1" 
                               class="slider-thumb w-full h-2 bg-blue-100 rounded-lg appearance-none cursor-pointer">
                    </div>
                    <div class="space-y-2">
                        <label for="cr-10" class="block text-sm font-medium text-gray-600">
                            10% æŠ˜æ‰£è½‰åŒ–ç‡: <span id="cr-10-val" class="font-bold text-blue-600">13</span>%
                        </label>
                        <input type="range" id="cr-10" value="13" min="0" max="50" step="0.1" 
                               class="slider-thumb w-full h-2 bg-blue-100 rounded-lg appearance-none cursor-pointer">
                    </div>
                    <div class="space-y-2">
                        <label for="cr-15" class="block text-sm font-medium text-gray-600">
                            15% æŠ˜æ‰£è½‰åŒ–ç‡: <span id="cr-15-val" class="font-bold text-blue-600">15</span>%
                        </label>
                        <input type="range" id="cr-15" value="15" min="0" max="50" step="0.1" 
                               class="slider-thumb w-full h-2 bg-blue-100 rounded-lg appearance-none cursor-pointer">
                    </div>
                    <div class="space-y-2">
                        <label for="cr-20" class="block text-sm font-medium text-gray-600">
                            20% æŠ˜æ‰£è½‰åŒ–ç‡: <span id="cr-20-val" class="font-bold text-blue-600">17</span>%
                        </label>
                        <input type="range" id="cr-20" value="17" min="0" max="50" step="0.1" 
                               class="slider-thumb w-full h-2 bg-blue-100 rounded-lg appearance-none cursor-pointer">
                    </div>
                    <div class="space-y-2">
                        <label for="cr-30" class="block text-sm font-medium text-gray-600">
                            30% æŠ˜æ‰£è½‰åŒ–ç‡: <span id="cr-30-val" class="font-bold text-blue-600">22</span>%
                        </label>
                        <input type="range" id="cr-30" value="22" min="0" max="50" step="0.1" 
                               class="slider-thumb w-full h-2 bg-blue-100 rounded-lg appearance-none cursor-pointer">
                    </div>
                </div>
            </div>
        </div>

        <!-- åœ–è¡¨åˆ†æ -->
        <div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- æˆæœ¬çµæ§‹åˆ†æ -->
            <div class="glass-effect p-6 rounded-xl shadow-lg">
                <h3 class="text-xl font-bold text-gray-700 mb-4 flex items-center">
                    <svg class="h-5 w-5 mr-2 text-orange-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                    æˆæœ¬çµæ§‹åˆ†æ
                </h3>
                <div class="chart-container">
                    <canvas id="cost-bar-chart"></canvas>
                </div>
            </div>

            <!-- æŠ˜æ‰£ vs. éŠ·é‡/åˆ©æ½¤ æ¨¡æ“¬åœ– -->
            <div class="glass-effect p-6 rounded-xl shadow-lg">
                <h3 class="text-xl font-bold text-gray-700 mb-4 flex items-center">
                    <svg class="h-5 w-5 mr-2 text-teal-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    æŠ˜æ‰£ vs. éŠ·é‡/åˆ©æ½¤ æ¨¡æ“¬
                </h3>
                <div class="chart-container">
                    <canvas id="simulation-chart"></canvas>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="glass-effect mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="text-center">
                <p class="text-gray-600 text-sm">
                    Â© 2025 Amazon Deal Fee åˆ©æ½¤è¨ˆç®—å™¨ | å°ˆç‚ºæ‡‰å° Amazon Deal Fee æ¼²åƒ¹è€Œè¨­è¨ˆ
                </p>
                <p class="text-gray-500 text-xs mt-2">
                    æ­¤å·¥å…·åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›çµæœå¯èƒ½å› å¸‚å ´æ¢ä»¶è€Œç•°
                </p>
            </div>
        </div>
    </footer>

    <script>
        // ç­‰å¾… DOM å’Œ Chart.js è¼‰å…¥å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            // ç­‰å¾… Chart.js è¼‰å…¥
            const waitForChart = () => {
                if (typeof Chart !== 'undefined') {
                    initializeCalculator();
                } else {
                    setTimeout(waitForChart, 100);
                }
            };
            waitForChart();
        });

        function initializeCalculator() {
            // åœ–è¡¨è®Šæ•¸
            let costBarChart, simulationChart;

            // DOM å…ƒç´ 
            const sessionsInput = document.getElementById('sessions');
            const sellingPriceInput = document.getElementById('selling-price');
            const productCostSlider = document.getElementById('product-cost');
            const fbaFeeSlider = document.getElementById('fba-fee');
            const tacosSlider = document.getElementById('tacos');
            const returnRateSlider = document.getElementById('return-rate');
            const dealTypeSelect = document.getElementById('deal-type');
            const dealOptionsDiv = document.getElementById('deal-options');

            // å€¼é¡¯ç¤ºå…ƒç´ 
            const productCostValSpan = document.getElementById('product-cost-val');
            const fbaFeeValSpan = document.getElementById('fba-fee-val');
            const tacosValSpan = document.getElementById('tacos-val');
            const returnRateValSpan = document.getElementById('return-rate-val');

            // è½‰åŒ–ç‡è¼¸å…¥å…ƒç´ 
            const crInputs = {
                '0': document.getElementById('cr-0'),
                '5': document.getElementById('cr-5'),
                '10': document.getElementById('cr-10'),
                '15': document.getElementById('cr-15'),
                '20': document.getElementById('cr-20'),
                '30': document.getElementById('cr-30')
            };
            const crValSpans = {
                '0': document.getElementById('cr-0-val'),
                '5': document.getElementById('cr-5-val'),
                '10': document.getElementById('cr-10-val'),
                '15': document.getElementById('cr-15-val'),
                '20': document.getElementById('cr-20-val'),
                '30': document.getElementById('cr-30-val')
            };
            const crPoints = Object.keys(crInputs).map(Number).sort((a,b)=>a-b);

            // çµæœé¡¯ç¤ºå…ƒç´ 
            const salesVolumeElem = document.getElementById('sales-volume');
            const totalRevenueElem = document.getElementById('total-revenue');
            const totalCostElem = document.getElementById('total-cost');
            const netProfitElem = document.getElementById('net-profit');
            const profitMarginElem = document.getElementById('profit-margin');
            const strategySuggestionElem = document.getElementById('strategy-suggestion');

            // åˆå§‹åŒ–æ»‘è»Œå€¼é¡¯ç¤º
            productCostValSpan.textContent = productCostSlider.value;
            fbaFeeValSpan.textContent = parseFloat(fbaFeeSlider.value).toFixed(2);
            tacosValSpan.textContent = tacosSlider.value;
            returnRateValSpan.textContent = returnRateSlider.value;

            // åˆå§‹åŒ–è½‰åŒ–ç‡å€¼é¡¯ç¤º
            for (const discount of crPoints) {
                crValSpans[discount].textContent = crInputs[discount].value;
            }

            // æ»‘è»Œäº‹ä»¶ç›£è½å™¨
            productCostSlider.addEventListener('input', () => {
                productCostValSpan.textContent = productCostSlider.value;
                calculateProfit();
            });

            fbaFeeSlider.addEventListener('input', () => {
                fbaFeeValSpan.textContent = parseFloat(fbaFeeSlider.value).toFixed(2);
                calculateProfit();
            });

            tacosSlider.addEventListener('input', () => {
                tacosValSpan.textContent = tacosSlider.value;
                calculateProfit();
            });

            returnRateSlider.addEventListener('input', () => {
                returnRateValSpan.textContent = returnRateSlider.value;
                calculateProfit();
            });

            // è½‰åŒ–ç‡æ»‘è»Œäº‹ä»¶ç›£è½å™¨
            for (const discount of crPoints) {
                crInputs[discount].addEventListener('input', () => {
                    crValSpans[discount].textContent = crInputs[discount].value;
                    calculateProfit();
                });
            }

            // ä¿ƒéŠ·é¡å‹è®Šæ›´äº‹ä»¶
            dealTypeSelect.addEventListener('change', () => {
                updateDealOptions();
                calculateProfit();
            });

            // å…¶ä»–è¼¸å…¥äº‹ä»¶ç›£è½å™¨
            sessionsInput.addEventListener('input', calculateProfit);
            sellingPriceInput.addEventListener('input', calculateProfit);

            // åˆå§‹åŒ–åœ–è¡¨
            initializeCharts();

            // åˆå§‹è¨ˆç®—
            calculateProfit();

            // æ›´æ–°ä¿ƒéŠ·é¸é …
            function updateDealOptions() {
                dealOptionsDiv.innerHTML = '';
                const dealType = dealTypeSelect.value;
                let html = '';

                if (dealType === 'lightning-deal' || dealType === '7-day-deal') {
                    html = `
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="deal-fee" class="block text-sm font-medium text-gray-600 mb-2">æ´»å‹•å›ºå®šè²»ç”¨</label>
                                <input type="number" id="deal-fee" value="150" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <div class="space-y-2">
                                <label for="deal-discount-percentage" class="block text-sm font-medium text-gray-600">
                                    æŠ˜æ‰£æ¯”ä¾‹: <span id="deal-discount-percentage-val" class="font-bold text-blue-600">20</span>%
                                </label>
                                <input type="range" id="deal-discount-percentage" value="20" min="0" max="100" step="1" 
                                       class="slider-thumb w-full h-2 bg-blue-100 rounded-lg appearance-none cursor-pointer">
                                <div class="flex justify-between text-xs text-gray-500">
                                    <span>0%</span>
                                    <span>50%</span>
                                    <span>100%</span>
                                </div>
                            </div>
                        </div>
                    `;
                } else if (dealType === 'coupon') {
                    html = `
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="coupon-amount" class="block text-sm font-medium text-gray-600 mb-2">å„ªæƒ åˆ¸é‡‘é¡</label>
                                <input type="number" id="coupon-amount" value="3" min="0" step="0.01" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <div>
                                <label for="coupon-redemption-rate" class="block text-sm font-medium text-gray-600 mb-2">å„ªæƒ åˆ¸ä½¿ç”¨ç‡ (%)</label>
                                <input type="number" id="coupon-redemption-rate" value="5" min="0" max="100" step="0.1" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <div>
                                <label for="coupon-days" class="block text-sm font-medium text-gray-600 mb-2">æ´»å‹•å¤©æ•¸</label>
                                <input type="number" id="coupon-days" value="30" min="1" max="90" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                        </div>
                    `;
                }

                dealOptionsDiv.innerHTML = html;

                // é‡æ–°ç¶å®šäº‹ä»¶ç›£è½å™¨
                dealOptionsDiv.querySelectorAll('input, select').forEach(input => {
                    input.addEventListener('input', calculateProfit);
                });

                // ç‚ºæŠ˜æ‰£æ»‘è»Œæ·»åŠ å€¼é¡¯ç¤ºæ›´æ–°
                if (dealType === 'lightning-deal' || dealType === '7-day-deal') {
                    const discountSlider = document.getElementById('deal-discount-percentage');
                    const discountVal = document.getElementById('deal-discount-percentage-val');
                    if (discountSlider && discountVal) {
                        discountVal.textContent = discountSlider.value;
                        discountSlider.addEventListener('input', () => {
                            discountVal.textContent = discountSlider.value;
                            calculateProfit();
                        });
                    }
                }
            }

            // åˆå§‹åŒ–åœ–è¡¨
            function initializeCharts() {
                // æˆæœ¬çµæ§‹é•·æ¢åœ–
                const costBarChartCtx = document.getElementById('cost-bar-chart').getContext('2d');
                costBarChart = new Chart(costBarChartCtx, {
                    type: 'bar',
                    data: {
                        labels: ['æ¡è³¼æˆæœ¬', 'FBA è²»ç”¨', 'ä½£é‡‘', 'ä¿ƒéŠ·è²»ç”¨', 'å»£å‘Šæˆæœ¬'],
                        datasets: [{
                            label: 'æˆæœ¬ç™¾åˆ†æ¯” (%)',
                            data: [0, 0, 0, 0, 0],
                            backgroundColor: ['#4299e1', '#667eea', '#805ad5', '#d53f8c', '#dd6b20'],
                            borderRadius: 8,
                            borderSkipped: false,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(tooltipItem) {
                                        return `ç¸½æˆæœ¬ä½”æ¯”: ${tooltipItem.raw.toFixed(2)}%`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                ticks: {
                                    font: { family: 'Noto Sans TC' }
                                }
                            },
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'ç™¾åˆ†æ¯” (%)'
                                }
                            }
                        }
                    }
                });

                // æ¨¡æ“¬åœ–è¡¨
                const simulationChartCtx = document.getElementById('simulation-chart').getContext('2d');
                simulationChart = new Chart(simulationChartCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: 'é ä¼°æœˆéŠ·é‡',
                                data: [],
                                borderColor: '#2b6cb0',
                                backgroundColor: 'rgba(43, 108, 176, 0.2)',
                                yAxisID: 'y',
                                tension: 0.2,
                                fill: true
                            },
                            {
                                label: 'æœˆæ·¨åˆ©æ½¤',
                                data: [],
                                borderColor: '#dd6b20',
                                backgroundColor: 'rgba(221, 107, 32, 0.2)',
                                yAxisID: 'y1',
                                tension: 0.2,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        stacked: false,
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.y !== null) {
                                            if (context.dataset.label === 'æœˆæ·¨åˆ©æ½¤') {
                                                label += '$' + context.parsed.y.toLocaleString(undefined, { minimumFractionDigits: 2 });
                                            } else {
                                                label += context.parsed.y.toLocaleString();
                                            }
                                        }
                                        return label;
                                    }
                                }
                            },
                            legend: {
                                position: 'top',
                            }
                        },
                        scales: {
                            x: {
                                title: { display: true, text: 'æŠ˜æ‰£æ¯”ä¾‹ (%)' }
                            },
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: { display: true, text: 'é ä¼°æœˆéŠ·é‡' }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: { display: true, text: 'æœˆæ·¨åˆ©æ½¤ ($)' },
                                grid: {
                                    drawOnChartArea: false,
                                },
                            },
                        }
                    }
                });
            }
            // ç·šæ€§æ’å€¼å‡½æ•¸
            function linearInterpolation(x, x1, y1, x2, y2) {
                if (x2 === x1) return y1;
                return y1 + (x - x1) * (y2 - y1) / (x2 - x1);
            }

            // ä¸»è¦è¨ˆç®—å‡½æ•¸
            function calculateProfit() {
                const sessions = parseFloat(sessionsInput.value) || 0;
                const normalPrice = parseFloat(sellingPriceInput.value) || 0;
                
                // ç”¢å“æˆæœ¬ç¾åœ¨æ˜¯å”®åƒ¹çš„ç™¾åˆ†æ¯”
                const productCostPercentage = parseFloat(productCostSlider.value) / 100 || 0;
                const productCost = normalPrice * productCostPercentage;

                const fbaFee = parseFloat(fbaFeeSlider.value) || 0;
                const tacos = parseFloat(tacosSlider.value) / 100 || 0;
                const returnRate = parseFloat(returnRateSlider.value) / 100 || 0;

                let discountPrice = normalPrice;
                let discountPercentage = 0;
                let promotionFixedCost = 0;
                let promotionVariableCostPerUnit = 0;

                const dealType = dealTypeSelect.value;
                const dealFeeInput = document.getElementById('deal-fee');
                const dealDiscountPercentageInput = document.getElementById('deal-discount-percentage');
                const couponAmountInput = document.getElementById('coupon-amount');
                const couponRedemptionRateInput = document.getElementById('coupon-redemption-rate');

                if (dealType === 'lightning-deal' || dealType === '7-day-deal') {
                    promotionFixedCost = parseFloat(dealFeeInput?.value) || 0;
                    discountPercentage = parseFloat(dealDiscountPercentageInput?.value) / 100 || 0;
                    discountPrice = normalPrice * (1 - discountPercentage);
                } else if (dealType === 'coupon') {
                    const couponAmount = parseFloat(couponAmountInput?.value) || 0;
                    const redemptionRate = parseFloat(couponRedemptionRateInput?.value) / 100 || 0;
                    promotionVariableCostPerUnit = couponAmount * redemptionRate;
                    // å„ªæƒ åˆ¸çš„æŠ˜æ‰£ç‡åŸºæ–¼å„ªæƒ åˆ¸é‡‘é¡
                    discountPercentage = couponAmount / normalPrice;
                }

                // ä½¿ç”¨ç·šæ€§æ’å€¼æ‰¾åˆ°è½‰åŒ–ç‡
                let conversionRate = 0;
                const discountP = Math.round(discountPercentage * 100);
                const crValues = {};
                for (const discount of crPoints) {
                    crValues[discount] = parseFloat(crInputs[discount].value);
                }

                if (discountP <= crPoints[0]) {
                    conversionRate = crValues[crPoints[0]];
                } else if (discountP >= crPoints[crPoints.length - 1]) {
                    conversionRate = crValues[crPoints[crPoints.length - 1]];
                } else {
                    let lowerPoint = crPoints.slice().reverse().find(p => p <= discountP);
                    let upperPoint = crPoints.find(p => p > discountP);
                    if (lowerPoint !== undefined && upperPoint !== undefined) {
                        const crLower = crValues[lowerPoint];
                        const crUpper = crValues[upperPoint];
                        conversionRate = linearInterpolation(discountP, lowerPoint, crLower, upperPoint, crUpper);
                    }
                }
                conversionRate /= 100;

                const salesVolume = Math.round(sessions * conversionRate);
                
                // èª¿æ•´é€€è²¨ç‡çš„éŠ·é‡
                const netSalesVolume = salesVolume * (1 - returnRate);
                const totalRevenue = netSalesVolume * discountPrice;
                
                const amazonCommissionRate = 0.15; // å‡è¨­ 15% ä½£é‡‘
                const commissionCost = salesVolume * discountPrice * amazonCommissionRate;
                const adCost = totalRevenue * tacos;
                
                const totalVariableCost = salesVolume * (productCost + fbaFee) + commissionCost + salesVolume * promotionVariableCostPerUnit;
                const totalFixedCost = promotionFixedCost;
                const totalCost = totalVariableCost + totalFixedCost + adCost;
                
                const netProfit = totalRevenue - totalCost;
                const profitMargin = totalRevenue > 0 ? (netProfit / totalRevenue) * 100 : 0;

                // æ›´æ–° UI
                const currencySymbol = document.getElementById('currency').value === 'JPY' ? 'Â¥' : '$';
                
                salesVolumeElem.textContent = salesVolume.toLocaleString();
                totalRevenueElem.textContent = currencySymbol + totalRevenue.toFixed(2);
                totalCostElem.textContent = currencySymbol + totalCost.toFixed(2);
                netProfitElem.textContent = currencySymbol + netProfit.toFixed(2);
                profitMarginElem.textContent = profitMargin.toFixed(2) + '%';
                
                // æ›´æ–°æˆæœ¬çµæ§‹åœ–è¡¨
                const totalCostSum = productCost * salesVolume + fbaFee * salesVolume + commissionCost + promotionFixedCost + adCost;
                if (totalCostSum > 0) {
                    costBarChart.data.datasets[0].data = [
                        (productCost * salesVolume / totalCostSum) * 100,
                        (fbaFee * salesVolume / totalCostSum) * 100,
                        (commissionCost / totalCostSum) * 100,
                        (promotionFixedCost / totalCostSum) * 100,
                        (adCost / totalCostSum) * 100
                    ];
                } else {
                    costBarChart.data.datasets[0].data = [0, 0, 0, 0, 0];
                }
                costBarChart.update();
                
                // é‹è¡Œä¸¦æ›´æ–°æ¨¡æ“¬åœ–è¡¨
                updateSimulationChart();

                // ç­–ç•¥å»ºè­°
                updateStrategySuggestion(profitMargin, netProfit, totalRevenue);
            }

            // æ›´æ–°æ¨¡æ“¬åœ–è¡¨
            function updateSimulationChart() {
                const sessions = parseFloat(sessionsInput.value) || 0;
                const normalPrice = parseFloat(sellingPriceInput.value) || 0;
                const productCostPercentage = parseFloat(productCostSlider.value) / 100 || 0;
                const fbaFee = parseFloat(fbaFeeSlider.value) || 0;
                const tacos = parseFloat(tacosSlider.value) / 100 || 0;
                const returnRate = parseFloat(returnRateSlider.value) / 100 || 0;

                const simulationData = [];
                const labels = [];

                // æ¨¡æ“¬æŠ˜æ‰£ç™¾åˆ†æ¯”å¾ 0% åˆ° 50%
                for (let discountP = 0; discountP <= 50; discountP += 1) {
                    labels.push(`${discountP}%`);

                    // æ‰¾åˆ°æ­¤æŠ˜æ‰£ç™¾åˆ†æ¯”çš„è½‰åŒ–ç‡
                    let conversionRate = 0;
                    const crValues = {};
                    for (const discount of crPoints) {
                        crValues[discount] = parseFloat(crInputs[discount].value);
                    }
                    
                    let lowerPoint = crPoints.slice().reverse().find(p => p <= discountP);
                    let upperPoint = crPoints.find(p => p >= discountP);

                    if (lowerPoint !== undefined && upperPoint !== undefined) {
                         const crLower = crValues[lowerPoint];
                         const crUpper = crValues[upperPoint];
                         conversionRate = linearInterpolation(discountP, lowerPoint, crLower, upperPoint, crUpper);
                    } else if (discountP < crPoints[0]) {
                         conversionRate = crValues[crPoints[0]];
                    } else {
                         conversionRate = crValues[crPoints[crPoints.length - 1]];
                    }

                    conversionRate /= 100;
                    
                    const discountPrice = normalPrice * (1 - discountP / 100);
                    const salesVolume = Math.round(sessions * conversionRate);
                    const netSalesVolume = salesVolume * (1 - returnRate);
                    const totalRevenue = netSalesVolume * discountPrice;

                    const productCost = normalPrice * productCostPercentage;
                    const amazonCommissionRate = 0.15;
                    const commissionCost = salesVolume * discountPrice * amazonCommissionRate;
                    const adCost = totalRevenue * tacos;
                    const promotionFixedCost = 0; // å‡è¨­æ¨¡æ“¬ä¸­æ²’æœ‰å›ºå®šä¿ƒéŠ·æˆæœ¬
                    const promotionVariableCostPerUnit = 0; // å‡è¨­æ¨¡æ“¬ä¸­æ²’æœ‰å„ªæƒ åˆ¸æˆæœ¬

                    const totalVariableCost = salesVolume * (productCost + fbaFee) + commissionCost + salesVolume * promotionVariableCostPerUnit;
                    const totalFixedCost = promotionFixedCost;
                    const totalCost = totalVariableCost + totalFixedCost + adCost;
                    
                    const netProfit = totalRevenue - totalCost;

                    simulationData.push({
                        discount: discountP,
                        sales: salesVolume,
                        profit: netProfit
                    });
                }

                simulationChart.data.labels = labels;
                simulationChart.data.datasets[0].data = simulationData.map(d => d.sales);
                simulationChart.data.datasets[1].data = simulationData.map(d => d.profit);
                simulationChart.update();
            }

            // æ›´æ–°ç­–ç•¥å»ºè­°
            function updateStrategySuggestion(profitMargin, netProfit, totalRevenue) {
                let suggestion = '';
                
                if (profitMargin > 20) {
                    suggestion = 'ğŸ‰ åˆ©æ½¤ç‡ç›¸ç•¶å¥åº·ï¼å¯ä»¥è€ƒæ…®å¢åŠ å»£å‘Šé ç®—æˆ–é€²è¡Œä¿ƒéŠ·æ´»å‹•ä¾†æ“´å¤§å¸‚å ´ä»½é¡ã€‚å»ºè­°æ¸¬è©¦æ›´é«˜çš„ TACOS ä¾†ç²å¾—æ›´å¤šæ›å…‰ã€‚';
                } else if (profitMargin > 10) {
                    suggestion = 'âš–ï¸ åˆ©æ½¤ç‡å°šå¯ï¼Œä½†ä»æœ‰å„ªåŒ–ç©ºé–“ã€‚å¯ä»¥å˜—è©¦é™ä½æ¡è³¼æˆæœ¬ã€å„ªåŒ– FBA è²»ç”¨ï¼Œæˆ–é©åº¦æé«˜å”®åƒ¹ã€‚è€ƒæ…® A/B æ¸¬è©¦ä¸åŒçš„å®šåƒ¹ç­–ç•¥ã€‚';
                } else if (profitMargin > 0) {
                    suggestion = 'âš ï¸ åˆ©æ½¤ç‡åä½ï¼Œéœ€è¦è¬¹æ…ç®¡ç†ã€‚å»ºè­°é‡æ–°è©•ä¼°æ¡è³¼æˆæœ¬ã€æ¸›å°‘ä¸å¿…è¦çš„ä¿ƒéŠ·æ´»å‹•ï¼Œä¸¦å„ªåŒ–å»£å‘ŠæŠ•æ”¾æ•ˆç‡ã€‚';
                } else {
                    suggestion = 'ğŸš¨ ç›®å‰è™•æ–¼è™§æç‹€æ…‹ï¼å»ºè­°ç«‹å³æª¢è¨æˆæœ¬çµæ§‹ï¼Œè€ƒæ…®æé«˜å”®åƒ¹ã€é™ä½æ¡è³¼æˆæœ¬ï¼Œæˆ–æš«åœé«˜æˆæœ¬çš„ä¿ƒéŠ·æ´»å‹•ã€‚';
                }

                // é‡å° Deal Fee æ¼²åƒ¹çš„ç‰¹åˆ¥å»ºè­°
                const dealType = dealTypeSelect.value;
                if (dealType === 'lightning-deal' || dealType === '7-day-deal') {
                    suggestion += '\n\nğŸ’¡ Deal Fee æ¼²åƒ¹å½±éŸ¿ï¼šç”±æ–¼ Amazon Deal Fee ä¸Šæ¼²ï¼Œå»ºè­°é‡æ–°è©•ä¼°ä¿ƒéŠ·æ´»å‹•çš„ ROIã€‚è€ƒæ…®ä½¿ç”¨å„ªæƒ åˆ¸æˆ–å…¶ä»–æˆæœ¬è¼ƒä½çš„ä¿ƒéŠ·æ–¹å¼ã€‚';
                }

                strategySuggestionElem.textContent = suggestion;
            }

            // åˆå§‹åŒ–ä¿ƒéŠ·é¸é …
            updateDealOptions();
        }
    </script>
</body>
</html>
